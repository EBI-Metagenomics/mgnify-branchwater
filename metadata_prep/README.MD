# Metadata database documentation

## Background and reasoning

The SRA accession metadata (attributes) provided in the app is built into a mongoDB from the [SRA BigQuery metadata table]([Setting-up BigQuery](https://www.ncbi.nlm.nih.gov/sra/docs/sra-bigquery/)). There are numerous combinations of attributes available for individual SRA accessions and a best effort was made to include well populated attributes. The BigQuery table contains ~40 select attributes for each accession or it's biosample as individual columns, with the biosample attributes containing a '_sam' suffix. The numerous remaining potential biosample attributes, are available as key-value pairs in .json contained in a column named `jattr` and each attribute is also given a '\_sam' suffix. This means that within the google could table, there can be duplicate attribute categories contained in both the columns and within the .json of biosample data (e.g., 'collection_date'). Since the SRA provides these attributes separately, and some accessions may vary in the content or formatting of the attribute information, both options were maintained as separate in the mongoDB built for the app. 

## Process of selecting metadata for use in buildmongo and advanced page in app

1. **attributeList.csv** - A custom 1 x 991 .csv file that contains all potential metadata attributes for accessions from three locations, 1) [the stated run and biosample attributes available in cloud-based metadata tables from NCBI]([Cloud-based Metadata Table](https://www.ncbi.nlm.nih.gov/sra/docs/sra-cloud-based-metadata-table/)), 2) [the comprehensive list of biosample attributes available from NCBI]([Biosample Attributes - BioSample - NCBI](https://www.ncbi.nlm.nih.gov/biosample/docs/attributes/)), and 3) additional attributes that are columns in the big query table, but not listed within #1 and #2.
2. **count_attr.py** - script that subsets from a previous list of mastiff accessions (in future builds, ideally this would pull from the Mastiff API), coarsely quantifies the percentage of accessions that have content for particular metadata (note, this could include the characters 'NA' or 'not available'), and subsets 'attributeList.csv' to attributes available for at least 4.5% of accessions. Filtered table is exported as `attrcounts_4.5percent.csv` to use for the mongo-DB build and creating the form on the `advanced.html` page.
3. **attrcounts_4.5percent_manualcategories.csv**-  a manually edited .csv where an additional column of 'metadata type' was added to `attrcounts_4.5percent.csv`, so that metadata attributes can be organized by rough categories for the form on the `advanced.html` webpage
4. **createform.py** - contains a function that generates an html string (saved in `app/static/formdata.js`) from `attrcounts_4.5percent_manualcategories.csv` to be used as a selection form in the webapp. While the html form imports properly as an object, because of the way`checked_string` is included within both an event listener and a fetch call, the content of `checked_string` must be copy and pasted from `app/static/formdata.js` to `app/static/fetchandplot.js`.
